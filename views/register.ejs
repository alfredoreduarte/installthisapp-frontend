<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" media="all" href="//fonts.googleapis.com/css?family=Lato:400,300italic,300,400italic,700,700italic,100,100italic" />
	<link rel="stylesheet" type="text/css" href="/landing/styles/styles.css" />
	<link rel="icon" type="image/png" href="/images/favicon.png" />
	<title>InstallThisApp</title>
</head>
<body>
	<span id="our-clients" class="hide"></span>
	<header class="jumbotron site-jumbotron white-text-area homepage-jumbotron home-header-2" id="large-header">
		<div class="container">
			<div class="homepage-jumbotron-conten">
				<h1 class="text-center site-title">Create an account</h1>
				<br/>
				<br/>
				<!-- <h2 class="text-center site-subtitle h3">
					Of course you do. That's why you're invited to the early preview of the new InstallThisApp.
				</h2> -->
				<div class="text-center hide">
					<span href="#" class="btn btn-lg btn-primary site-cta cta-glow">Start now</span>
					<button onclick="javascript:login()" class="btn btn-lg btn-primary site-cta absolute-horizontal-center" data-loading-text="Please wait...">Start now</button>
				</div>
			</div>
			<div class="col-md-6 col-md-offset-3">
				<div class="form-group">
					<input type="email" id="email" class="form-control" placeholder="Email">
				</div>
				<div class="form-group">
					<input type="password" id="password" class="form-control" placeholder="Password">
				</div>
				<p class="text-center"><button type="submit" class="btn btn-primary btn-lg" onclick="javascript:register();">Create Account</button></p>
				<br/>
				<br/>
				<p class="text-right" style="font-size: 12px">Already have an account? <a href="/login">Login â†’</a></p>
			</div>
		</div>
		<canvas id="demo-canvas" class="hidden-xs hidden-sm"></canvas>
	</header>
	<script type="text/javascript" src="<%= cloudFrontUrl %>/landing/landing.js"></script>
	<script type="text/javascript" src="<%= cloudFrontUrl %>/node_modules/js-cookie/src/js.cookie.js"></script>
	<script>
		var saveCookie = function(name, value){
			Cookies.set(name, value)
		}
		var register = function(){
			var email = $('#email').val()
			var password = $('#password').val()
			fetch('<%= apiUrl %>/auth.json', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					email: $('#email').val(),
					password: $('#password').val(),
					confirm_success_url: 'https://' + window.location.hostname + '/d?email_confirmed=true'
				})
			}).then(response => {
				return response.json()
			})
			.then(json => {
				login(email, password)
			})
			.catch(exception =>
				console.log('parsing failed', exception)
			)
		}
		var login = function(email, password){
			if (!email) {
				email = $('#email').val()
			}
			if (!password) {
				password = $('#password').val()
			}
			fetch('<%= apiUrl %>/auth/sign_in.json', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					email: email,
					password: password
				})
			})
			.then(response => {
				saveCookie('access-token', response.headers.get('access-token'))
				saveCookie('token-type', response.headers.get('token-type'))
				saveCookie('client', response.headers.get('client'))
				saveCookie('uid', response.headers.get('uid'))
				return response.json()
			})
			.then(json => {
				analytics.track('Account Created', () => {
					top.location = location.protocol + '//' + window.location.host + '/d'
				})
			})
			.catch(exception =>
				console.log('parsing failed', exception)
			)
		}
	</script>
	<%- include('_segment') %>
	<script type="text/javascript">
		analytics.page('Signup')
	</script>
</body>
</html>