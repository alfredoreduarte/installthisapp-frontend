<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" media="all" href="//fonts.googleapis.com/css?family=Lato:400,300italic,300,400italic,700,700italic,100,100italic" />
	<link rel="stylesheet" type="text/css" href="/landing/styles/styles.css" />
	<link rel="icon" type="image/png" href="/images/favicon.png" />
	<title>InstallThisApp</title>
</head>
<body>
	<span id="our-clients" class="hide"></span>
	<header class="jumbotron site-jumbotron white-text-area homepage-jumbotron home-header-2" id="large-header">
		<div class="container">
			<div class="homepage-jumbotron-content hide">
				<h1 class="text-center site-title">Do you like trying new things?</h1>
				<h2 class="text-center site-subtitle h3">
					Of course you do. That's why you're invited to the early preview of the new InstallThisApp.
				</h2>
				<div class="text-center">
					<span href="#" class="btn btn-lg btn-primary site-cta cta-glow">Start now</span>
					<button onclick="javascript:login()" class="btn btn-lg btn-primary site-cta absolute-horizontal-center" data-loading-text="Please wait...">Start now</button>
				</div>
			</div>
			<div>
				<div class="form-group">
					<input type="email" id="email" class="form-control" value="alfredo@agenciamoderna.com.py" placeholder="Email">
				</div>
				<div class="form-group">
					<input type="password" id="password" class="form-control" value="minuevopass" placeholder="Password">
				</div>
				<p><button type="submit" class="btn btn-default" onclick="javascript:register();">Register</button></p>
				<p><button type="submit" class="btn btn-default" onclick="javascript:login();">Login</button></p>
				<br/>
				<p><a href="/forgot"><small>Forgot your password?</small></a></p>
			</div>
		</div>
		<canvas id="demo-canvas" class="hidden-xs hidden-sm"></canvas>
	</header>
	<script type="text/javascript" src="/landing/landing.js"></script>
	<script type="text/javascript" src="/node_modules/js-cookie/src/js.cookie.js"></script>
	<script>
		var saveCookie = function(name, value){
			Cookies.set(name, value)
		}
		var register = function(){
			var email = $('#email').val()
			var password = $('#password').val()
			fetch('<%= apiUrl %>/auth.json', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					email: $('#email').val(),
					password: $('#password').val(),
					confirm_success_url: 'https://localhost.ssl:3000'
				})
			}).then(response => {
				return response.json()
			})
			.then(json => {
				console.log('register response')
				console.log(json)
				login(email, password)
			})
			.catch(exception =>
				console.log('parsing failed', exception)
			)
		}
		var login = function(email, password){
			if (!email) {
				email = $('#email').val()
			}
			if (!password) {
				password = $('#password').val()
			}
			console.log('email', email)
			console.log('password', password)
			fetch('<%= apiUrl %>/auth/sign_in.json', {
				method: 'POST',
				headers: {
					'Accept': 'application/json',
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					email: email,
					password: password
				})
			})
			.then(response => {
				saveCookie('access-token', response.headers.get('access-token'))
				saveCookie('token-type', response.headers.get('token-type'))
				saveCookie('client', response.headers.get('client'))
				saveCookie('uid', response.headers.get('uid'))
				return response.json()
			})
			.then(json => {
				console.log('login response')
				console.log(json)
				top.location = location.protocol + '//' + window.location.host + '/d'
			})
			.catch(exception =>
				console.log('parsing failed', exception)
			)
		}
		var fbLogin = function(){
			FB.login(function(response) {
				fetch('<%= apiUrl %>/fb_profiles.json', {
					method: 'POST',
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json',
						'access-token': Cookies.get('access-token'),
						'token-type': Cookies.get('token-type'),
						'uid': Cookies.get('uid'),
						'client': Cookies.get('client'),
					},
					body: JSON.stringify({
						authResponse: response.authResponse
					})
				}).then(response => {
					return response.json()
				})
				.then(json => {
					console.log(json)
				})
				.catch(exception =>
					console.log('parsing failed', exception)
				)
			}, {
				scope: 'email'
			})
		}

		window.fbAsyncInit = function() {
			FB.init({
				appId      : '<%=facebookAppId%>',
				xfbml      : true,
				version    : 'v2.7'
			});
		};

		(function(d, s, id){
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js";
		fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>
	<%- include('_segment') %>
	<script type="text/javascript">
		analytics.page({
			name:  'Home',
		})
	</script>
</body>
</html>